generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  USER
  SELLER
  ADMIN
}

enum AuthProvider {
  LOCAL
  GOOGLE
  FACEBOOK
}

enum PersonType {
  PF
  PJ
}

enum BusinessProfileStatus {
  UNVERIFIED
  VERIFIED
  CANCELLED
}

model User {
  id           String        @id @default(cuid())
  email        String        @unique
  name         String
  password     String?
  avatar       String?
  phone        String?
  cpf          String?       @unique
  birthDate    DateTime?
  whatsapp     String?
  instagram    String?
  facebook     String?
  role         UserRole      @default(USER)
  provider     AuthProvider? @default(LOCAL)
  providerId   String?
  status       String        @default("ACTIVE")
  isVerified   Boolean       @default(false)
  isActive     Boolean       @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  businessProfiles BusinessProfile[]
  sessions         Session[]

  @@map("users")
}

model BusinessProfile {
  id     String @id @default(cuid())
  userId String

  personType PersonType @default(PJ)
  status     BusinessProfileStatus @default(UNVERIFIED)

  cpf String? @unique
  companyName String?
  cnpj        String? @unique
  tradingName String?
  description String? @db.Text
  companyLogo String?
  categories  String?

  cep          String?
  street       String?
  number       String?
  complement   String?
  neighborhood String?
  city         String?
  state        String?
  latitude     Float?
  longitude    Float?

  instagram String?
  facebook  String?
  whatsapp  String?
  website   String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("business_profiles")
}

model Session {
  id           String   @id @default(cuid())
  userId       String
  accessToken  String   @unique
  refreshToken String   @unique
  expiresAt    DateTime
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}
